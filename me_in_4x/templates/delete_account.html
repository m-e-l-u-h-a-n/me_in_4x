{% extends 'base_generic.html' %}
{% block title %}
<title>Me in 4x | Delete account</title>
{% endblock title %}
{% block body %}
<div class="row">
    <h4><strong>Enter either of email or username to delete to the account.</strong></h4>
</div>
<div class="row" style="margin-top: 80px;">
    <div class="form-group col-md-12">
        <div class="container">
            <div class="row">
                <label for="id_email"
                    class="form-label col-12 col-md-2 align-self-center"><strong>Email:</strong></label>
                <input type="email" name="email" maxlength="256" id="id_email" class="form-control col-12 col-md-10">
            </div>
        </div>
    </div>
    <div class="form-group col-md-12">
        <div class="container">
            <div class="row">
                <label for="id_username"
                    class="form-label col-md-2 align-self-center"><strong>Username:</strong></label>
                <input type="text" name="username" maxlength="256" id="id_username" class="form-control col-md-10">
            </div>
        </div>
    </div>
    <div class="col-md-12 form-group">
        <div class="container">
            <button onclick="deleteAccount()" class="btn btn-outline-warning text-black">Delete account</button>
        </div>
    </div>
</div>
{% endblock body %}
{% block extra %}
<script>
    function deleteAccount() {
        requestUsername = 'tullu_pump'; requestUsermail = 'ckvmda,kmvksm';
        const username = document.getElementById("id_username").value;
        const email = document.getElementById("id_email").value;
        console.log(`username = ${username}`);
        console.log(`email = ${email}`);
        console.log(`requestUsername = ${requestUsername}`);
        console.log(`requestUsermail = ${requestUsermail}`);
        if (username.length == 0 && email.length == 0) {
            iziToast.warning({
                title: "Warning",
                message: "Enter at least one field",
                position: "bottomCenter"
            });
        }
        else {
            if ((username.length > 0 && username != requestUsername) || (email.length > 0 && email != requestUsermail)) {
                iziToast.warning({
                    title: "Warning",
                    message: "Please enter your account's credentials!",
                    position: "bottomCenter"
                });
            }
            else {
                let way;
                if (username != '' && email == '') {
                    way = "u";
                }
                else if (username == '' && email != '') {
                    way = "e";
                }
                else {
                    way = "b";
                }
                $.ajax({
                    url: "{% url 'delete_account' %}",
                    method: "POST",
                    data: {
                        way: way,
                        username: username,
                        email: email,
                    },
                    success: function (data, status, xhr) {
                        iziToast.success(
                            {
                                title: "Success",
                                message: "Account deleted successfully",
                                position: "bottomCenter"
                            }
                        );
                        window.location.replace("");
                    },
                    error: function (xhr, status, err) {
                        iziToast.error(
                            {
                                title: "Error",
                                message: "No users with given credentials!",
                                position: "bottomCenter"
                            }
                        );
                    }
                })
            }
        }
    }
</script>
{% include 'notification.html' %}
{% endblock extra %}